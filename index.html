<!DOCTYPE html>
<html>
<head>
  <meta property="og:title" content="Unightly Club Hangout">
  <meta property="og:description" content="Join Unightly Club Hangout for VRChat events, parties, and community meetups. Stay up-to-date with the latest announcements and event schedule.">
  <meta property="og:image" content="https://raw.githubusercontent.com/silentmason/Unightly-Club-Hangout/main/UCHimage.webp">
  <meta property="og:url" content="https://unightly-club-hangout.github.io/unightlyclubhangout">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Unightly Club Hangout">
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Join Unightly Club Hangout for VRChat events, parties, and community meetups. Stay up-to-date with the latest announcements and event schedule!">
  <title>Unightly Club Hangout</title>
  <link rel="icon" href="https://raw.githubusercontent.com/silentmason/Unightly-Club-Hangout/main/UCHimage.webp" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6JZ4GR0CGC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6JZ4GR0CGC');

  function dispatchToolsClickEvent () {
    const event = new CustomEvent('toolsLinkClicked', {
      detail: {
        timestamp: new Date().toISOString()
      }
    });
    window.dispatchEvent(event);
  }
</script>
</head>
<body>
  <header>
    <h1>Unightly Club Hangout</h1>
    <nav>
      <a href="">Home</a>
      <a href="about.html">About</a>
      <a href="https://uch.booth.pm/">Store</a>
      <a href="tools.html" onclick="dispatchToolsClickEvent()">Tools</a>
    </nav>
  </header>
  <div class="content">
    <div id="posts-container">
      Loading posts...
    </div>
  <div id="discord-widget">
    <div id="loading-events">Loading events...</div>
</div>
  </div>
  <footer>
    <a href="https://unightly-club-hangout.github.io/uch/terms_of_service.html">Terms of Service</a>
    <a href="https://unightly-club-hangout.github.io/uch/privacy_policy.html">Privacy Policy</a>
    <a href="https://unightly-club-hangout.github.io/uch/issue.html">System Status</a>
  </footer>
  <script src="index.js"></script>
  <script>
  function loadEvents() {
    const googleSheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTuSjI-BjIDgQNkW7Q_Xec8iy_oybjJ2Mkw0uV06ZPKqm7hBZs8_a9JoxFNqWUZW_KWuHC57qCVSB9V/pub?output=csv';
    const loadingEvents = document.getElementById('loading-events');
    const discordWidget = document.getElementById('discord-widget');
    let hasEvents = false; // Track if there are any events to display

    // Show loading indicator
    loadingEvents.style.display = 'block';
    discordWidget.style.display = 'block'; // Ensure widget is visible initially

    fetch(googleSheetUrl)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
      })
        .then(csvData => {
            const events = parseCSV(csvData);
            displayEvents(events);
      })
        .catch(error => {
            console.error('Error fetching or processing data:', error);
            //If you encounter a CORS error here, you might need a server-side proxy.
        })
        .finally(() => {
        // Hide loading indicator
            loadingEvents.style.display = 'none';
      });
  }

  function parseCSV(csvData) {
    console.log(csvData); // Log the raw CSV data for debugging
    const lines = csvData.split('\n');
    const headers = lines[0].split(',');
    const events = [];

    for (let i = 1; i < lines.length; i++) {
      const data = lines[i].split(',');
      if (data.length === headers.length) {
        const event = {};
        for (let j = 0; j < headers.length; j++) {
          event[headers[j]] = data[j].trim();
        }
        events.push(event);
      }
    }
    return events;
  }

function displayEvents(events) {
    const discordWidget = document.getElementById('discord-widget');
    let hasEvents = false; // Track if there are any events to display
    console.log("displayEvents called");
    console.log(events);

    events.forEach(event => {
        console.log("Event in forEach", event);
        // Check if the event object has the "Display" property
        if (event.hasOwnProperty("Display")) {
            const displayValue = event["Display"];
            console.log("Display value:", displayValue); // Add this line

            if (displayValue && displayValue.trim().toUpperCase() === "Y") { // Check the "Display" column
                hasEvents = true; // Set to true if at least one event is displayed
                const eventDiv = document.createElement('div');
                eventDiv.className = 'discord-event';
                eventDiv.innerHTML = `
                    <h3>${event["Event Name"]}</h3>
                    <p>Date: ${event["Date"]}</p>
                    <p>Time: ${event["Time"]}</p>
                    <p>Description: ${event["Description"]}</p>
                    <a href="${event["Link"]}">Join Event</a>
                `;
                discordWidget.appendChild(eventDiv);
            }
        } else {
            console.warn("Event object missing 'Display' property:", event);
        }
    });

    // Hide the discord-widget if no events are displayed
    if (!hasEvents) {
        discordWidget.style.display = 'none';
        discordWidget.style.height = '0px';
    } else {
        discordWidget.style.display = 'block';
        discordWidget.style.height = 'auto';
    }
}

  // Load events when the page loads
  window.onload = loadEvents;
</script>
</body>
</html>