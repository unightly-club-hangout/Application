<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Unightly Club Hangout</title>
  <link rel="icon" href="https://raw.githubusercontent.com/silentmason/Unightly-Club-Hangout/main/UCHimage.webp" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Unightly Club Hangout</h1>
    <nav>
      <a href="">Home</a>
      <a href="about.html">About</a>
      <a href="https://unightlyclubhangout.tawk.help/">Support</a>
      <a href="store.html">Store</a>
    </nav>
  </header>
  <div class="content">
    <div id="loading">
      Loading posts...
    </div>
    <div id="posts-container" style="display: none;"></div>
  </div>
  <footer>
    <a href="https://unightly-club-hangout.github.io/uch/terms_of_service.html">Terms of Service</a>
    <a href="https://unightly-club-hangout.github.io/uch/privacy_policy.html">Privacy Policy</a>
    <a href="https://unightly-club-hangout.github.io/uch/issue.html">System Status</a>
  </footer>
  <div class="discord-widget">
    <iframe src="https://discord.com/widget?id=1401631295108546590&theme=dark" width="350" height="500" allowtransparency="true" frameborder="0" ></iframe>
  </div>
  <script>
let previousPosts = [];
let previousTitles = []; // Track previous post titles
let previousLength = 0; // Keep track of the previous data length
    const githubRawURL = 'https://gist.githubusercontent.com/silentmason/46d973b3702d6d81d8eeb7e5659caaa1/raw/f39d15024f176604e69d15962814771e8f600b98/posts.json'; // Replace with your Github Raw URL



    function displayPosts(posts) {
      const postsContainer = document.getElementById("posts-container");
      postsContainer.innerHTML = "";
      posts.forEach(post => {
        const postDiv = document.createElement("div");
        postDiv.innerHTML = `
          <h2>${post.Title}</h2>
          <p>${post.Content}</p>
          ${post.ImageURL ? `<img src="${post.ImageURL}" alt="${post.Title}">` : ""}
        `;
        postsContainer.appendChild(postDiv);
      });
    }

    async function sendToDiscord(post) {
      const webhookUrl = discordWebhookUrl;

      // Check if the Discord column contains 'X' or 'Y'
      if (post.Discord === "X") {
        console.log("Discord post disabled for this message.");
        return; // Prevent sending the webhook
    }

      const message = {
        embeds: [{
          title: post.Title,
          description: post.Content,
          image: post.ImageURL ? { url: post.ImageURL } : null
        }]
      };

      try {
        await fetch(webhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(message)
        });
        console.log('Post sent to Discord!');
    } catch (error) {
        console.error('Error sending to Discord:', error);
      }
    }


    async function checkForNewPosts() {
      try {
        const response = await fetch(githubRawURL);
         const data = await response.json()

        displayPosts(data);

        //NEW - Check the messages and only send newest
        if (data.length > previousLength) {

          const newestPost = data[0];
          await sendToDiscord(newestPost);
          previousLength = data.length
        }
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    // Check for new posts every 5 seconds (adjust as needed)
    setInterval(checkForNewPosts, 5000);
    checkForNewPosts()
</script>
</body>
</html>