<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unightly Club Hangout</title>

  <!-- Open Graph -->
  <meta property="og:title" content="Unightly Club Hangout" />
  <meta property="og:description" content="Hangout for VRChat events, parties, and community meetups." />
  <meta property="og:image" content="https://yourdomain.com/preview.jpg" />
  <meta property="og:url" content="https://yourdomain.com/" />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Unightly Club Hangout" />
  <meta name="twitter:description" content="Hangout for VRChat events, parties, and community meetups." />
  <meta name="twitter:image" content="https://yourdomain.com/preview.jpg" />

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Navigation -->
  <nav>
    <a href="">Home</a>
    <a href="about.html">About</a>
    <a href="store.html">Store</a>
    <a href="uhc_booth.html">UHC Booth</a>
    <a href="tools.html">Tools</a>
  </nav>

  <!-- Manual Refresh Button -->
  <button id="refresh-button">ðŸ”„ Refresh Content</button>

  <!-- Event Containers -->
  <div class="events-container">
    <div id="discord-widget">
      <div id="loading-events">Loading announcements...</div>
    </div>
    <div id="main-posts-widget">
      <div id="loading-posts">Loading posts...</div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <a href="terms_of_service.html">Terms of Service</a>
    <a href="privacy_policy.html">Privacy Policy</a>
    <a href="system_status.html">System Status</a>
  </footer>

  <script>
    const ANNOUNCEMENTS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTuSjI-BjIDgQNkW7Q_Xec8iy_oybjJ2Mkw0uV06ZPKqm7hBZs8_a9JoxFNqWUZW_KWuHC57qCVSB9V/pub?output=csv';
    const MAIN_POSTS_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTWHMfgoHQ33CDC9H30UMh67iQBpcBXv1s1cLH8-FQfZkW_VUsq2O0npXFmxBV7j9xkk16wWQo4tP29/pub?output=csv';
    const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 minutes

    function loadSheet(url, containerId, loadingId) {
      const loadingEl = document.getElementById(loadingId);
      loadingEl.style.display = 'block';

      fetch(url)
        .then(response => {
          if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
          return response.text();
        })
        .then(csv => {
          loadingEl.style.display = 'none';
          const data = parseCSV(csv);
          displayItems(data, containerId);
        })
        .catch(error => {
          loadingEl.style.display = 'none';
          console.error(`Error loading sheet for ${containerId}:`, error);
        });
    }

    function parseCSV(csvData) {
      const lines = csvData.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      const items = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(v => v.trim());
        const item = {};
        headers.forEach((header, index) => {
          item[header] = values[index] || '';
        });
        items.push(item);
      }

      return items;
    }

    function displayItems(items, containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      let hasVisible = false;

      items.forEach(item => {
        if (item.Display && item.Display.trim().toUpperCase() === 'TRUE') {
          const div = document.createElement('div');
          div.className = 'event';
          div.innerHTML = `
            <h3>${item.Name}</h3>
            <p>Date: ${item.Date || ''}</p>
            <p>Time: ${item.Time || ''}</p>
            <p>Description: ${item.Description || ''}</p>
            ${item.Link ? `<p><a href="${item.Link}" target="_blank">Join</a></p>` : ''}
          `;
          container.appendChild(div);
          hasVisible = true;
        }
      });

      container.style.display = hasVisible ? 'block' : 'none';
      container.style.height = hasVisible ? 'auto' : '0px';

      if (!hasVisible) {
        container.innerHTML = `<p>No upcoming items to display.</p>`;
      }
    }

    function refreshSheets() {
      loadSheet(ANNOUNCEMENTS_URL, 'discord-widget', 'loading-events');
      loadSheet(MAIN_POSTS_URL, 'main-posts-widget', 'loading-posts');
    }

    window.onload = refreshSheets;
    setInterval(refreshSheets, REFRESH_INTERVAL);

    document.getElementById('refresh-button').addEventListener('click', () => {
      refreshSheets();
    });
  </script>
</body>
</html>